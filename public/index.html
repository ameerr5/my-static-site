<!--
Blood Donation System (Single-file web app)
Features:
- Register Donor or Recipient (Name, Role, Blood Group, City, Phone, Notes)
- Store entries in localStorage
- List donors and recipients
- Find matches: same city + compatible blood group (exact match + O- universal donor + optional compat map)
- Export / Import JSON
- Simple, responsive UI (vanilla HTML/CSS/JS)

Deployment:
1. Create a new GitHub repository and push this file as `index.html` to the repo root.
2. On Vercel, import the GitHub repo, point the project to the repo. Vercel will automatically detect and deploy a static site.
   - Alternatively, you can deploy using Vercel CLI: `vercel` in the repo folder.

Notes:
- This is a client-side app (no backend). For production, replace localStorage with a server (Node/Express + DB) and protect user data.
- The app includes a simple blood-group compatibility system; consult medical professionals for production rules.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blood Donation Match — Local</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#e53e3e;--muted:#6b7280;--glass:rgba(255,255,255,0.6)}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{margin:0;background:linear-gradient(180deg,#f8fafc,#edf2f7);min-height:100vh;color:#111827;padding:24px}
    .container{max-width:1000px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);padding:16px}
    form .row{display:flex;gap:8px;margin-bottom:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:14px}
    textarea{min-height:68px;resize:vertical}
    button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:transparent;border:1px solid #cbd5e1;color:#111827}
    .lists{display:flex;flex-direction:column;gap:12px}
    .list{max-height:260px;overflow:auto;padding:8px;border-radius:8px;border:1px dashed #e6eef5}
    .entry{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px}
    .pill{font-size:12px;padding:6px 8px;border-radius:999px;background:#f3f4f6;border:1px solid #e6e9ef}
    .match{background:#ecfeff;border:1px solid #bdeefd}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Blood Donation — Local Match</h1>
      <div style="color:var(--muted);font-size:13px">Register donors & recipients. Matches limited to same city.</div>
    </header>

    <div class="grid">
      <section class="card">
        <h3 style="margin-top:0">Register Donor / Recipient</h3>
        <form id="entryForm">
          <div class="row">
            <div style="flex:1">
              <label for="name">Full Name</label>
              <input id="name" required />
            </div>
            <div style="width:140px">
              <label for="role">Role</label>
              <select id="role">
                <option value="donor">Donor</option>
                <option value="recipient">Recipient</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label for="blood">Blood Group</label>
              <select id="blood">
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            <div style="width:140px">
              <label for="city">City</label>
              <input id="city" placeholder="e.g. Lahore" required />
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label for="phone">Phone / WhatsApp</label>
              <input id="phone" placeholder="+92xxxxxxxxxx" />
            </div>
            <div style="width:140px">
              <label>&nbsp;</label>
              <button id="submitBtn" type="submit">Save</button>
            </div>
          </div>

          <div style="margin-top:6px">
            <label for="notes">Notes</label>
            <textarea id="notes" placeholder="Any additional info (e.g. available dates)"></textarea>
          </div>
        </form>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7" />

        <div class="controls">
          <button id="exportBtn" class="secondary">Export JSON</button>
          <button id="importBtn" class="secondary">Import JSON</button>
          <input id="importFile" type="file" accept="application/json" style="display:none" />
          <button id="clearBtn" class="secondary">Clear All</button>
          <button id="seedBtn" class="secondary">Add Sample Data</button>
        </div>

      </section>

      <aside class="card">
        <h4 style="margin-top:0">Quick Actions & Matches</h4>
        <div style="margin-bottom:10px">
          <label for="filterCity">Filter City (for listing)</label>
          <input id="filterCity" placeholder="leave empty to show all" />
        </div>

        <div style="display:flex;gap:8px;margin-bottom:10px">
          <button id="showLists">Show Lists</button>
          <button id="findMatches">Find Matches</button>
        </div>

        <h5 style="margin:6px 0">Results</h5>
        <div class="lists">
          <div>
            <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Donors</div>
            <div id="donorList" class="list"></div>
          </div>
          <div>
            <div style="font-size:13px;color:var(--muted);margin-bottom:6px">Recipients</div>
            <div id="recipientList" class="list"></div>
          </div>
        </div>
      </aside>
    </div>

    <footer>
      <strong>How to use:</strong> Register donors and recipients. Click "Find Matches" to list donor-recipient pairs in the same city and compatible blood groups. Export data to share with others. For production, use a server and authentication.
    </footer>
  </div>

  <script>
    // Simple client-side data store using localStorage
    const STORAGE_KEY = 'blood_local_store_v1';

    // Basic blood compatibility map (recipient -> compatible donor groups)
    const compatibility = {
      'A+':['A+','A-','O+','O-'],
      'A-':['A-','O-'],
      'B+':['B+','B-','O+','O-'],
      'B-':['B-','O-'],
      'AB+':['A+','A-','B+','B-','AB+','AB-','O+','O-'],
      'AB-':['A-','B-','AB-','O-'],
      'O+':['O+','O-'],
      'O-':['O-']
    };

    // Utility
    const $ = id => document.getElementById(id);

    function loadStore(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){console.error(e);return []}
    }
    function saveStore(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

    function addEntry(entry){
      const arr = loadStore(); arr.push(entry); saveStore(arr); }

    function clearStore(){ localStorage.removeItem(STORAGE_KEY); }

    function renderLists(filterCity=''){
      const arr = loadStore();
      const donors = arr.filter(x=>x.role==='donor' && (!filterCity || x.city.toLowerCase()===filterCity.toLowerCase()));
      const recipients = arr.filter(x=>x.role==='recipient' && (!filterCity || x.city.toLowerCase()===filterCity.toLowerCase()));

      const donorList = $('donorList'); donorList.innerHTML='';
      donors.forEach((d,i)=>{
        const el = document.createElement('div'); el.className='entry';
        el.innerHTML = `<div><strong>${escapeHtml(d.name)}</strong> <span style="color:var(--muted);font-size:13px">${escapeHtml(d.blood)} • ${escapeHtml(d.city)}</span><div style="font-size:12px;color:var(--muted)">${escapeHtml(d.notes||'')}</div></div><div class="pill">${escapeHtml(d.phone||'')}</div>`;
        donorList.appendChild(el);
      });

      const recipientList = $('recipientList'); recipientList.innerHTML='';
      recipients.forEach((r,i)=>{
        const el = document.createElement('div'); el.className='entry';
        el.innerHTML = `<div><strong>${escapeHtml(r.name)}</strong> <span style="color:var(--muted);font-size:13px">${escapeHtml(r.blood)} • ${escapeHtml(r.city)}</span><div style="font-size:12px;color:var(--muted)">${escapeHtml(r.notes||'')}</div></div><div class="pill">${escapeHtml(r.phone||'')}</div>`;
        recipientList.appendChild(el);
      });
    }

    function findMatches(){
      const arr = loadStore();
      const recipients = arr.filter(x=>x.role==='recipient');
      const donors = arr.filter(x=>x.role==='donor');
      const results = [];
      recipients.forEach(r=>{
        const city = r.city.trim().toLowerCase();
        const allowed = compatibility[r.blood] || [r.blood];
        const matched = donors.filter(d=>d.city.trim().toLowerCase()===city && allowed.includes(d.blood));
        if(matched.length) results.push({recipient:r, donors:matched});
      });
      showMatchResults(results);
    }

    function showMatchResults(results){
      const donorList = $('donorList'); donorList.innerHTML='';
      const recipientList = $('recipientList'); recipientList.innerHTML='';

      if(results.length===0){ donorList.innerHTML='<div style="padding:10px;color:var(--muted)">No matches found</div>'; recipientList.innerHTML=''; return }

      results.forEach(group=>{
        const r = group.recipient;
        const recEl = document.createElement('div'); recEl.className='entry match';
        recEl.innerHTML = `<div><strong>${escapeHtml(r.name)}</strong> <div style="font-size:13px;color:var(--muted)">${escapeHtml(r.blood)} • ${escapeHtml(r.city)} — Recipient</div></div><div class="pill">${escapeHtml(r.phone||'')}</div>`;
        recipientList.appendChild(recEl);

        group.donors.forEach(d=>{
          const el = document.createElement('div'); el.className='entry';
          el.innerHTML = `<div><strong>${escapeHtml(d.name)}</strong> <div style="font-size:13px;color:var(--muted)">${escapeHtml(d.blood)} • ${escapeHtml(d.city)} — Donor</div></div><div class="pill">${escapeHtml(d.phone||'')}</div>`;
          donorList.appendChild(el);
        });
      });
    }

    // Very small sanitizer for innerHTML usage below
    function escapeHtml(str){ if(!str && str!==0) return ''; return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // load listeners
    document.addEventListener('DOMContentLoaded', ()=>{
      renderLists();

      $('entryForm').addEventListener('submit', e=>{
        e.preventDefault();
        const name = $('name').value.trim();
        const role = $('role').value;
        const blood = $('blood').value;
        const city = $('city').value.trim();
        const phone = $('phone').value.trim();
        const notes = $('notes').value.trim();
        if(!name || !city){ alert('Please fill name and city'); return }
        addEntry({id:Date.now(), name, role, blood, city, phone, notes, created:new Date().toISOString()});
        $('entryForm').reset();
        renderLists($('filterCity').value.trim());
      });

      $('showLists').addEventListener('click', ()=> renderLists($('filterCity').value.trim()));
      $('findMatches').addEventListener('click', ()=> findMatches());

      $('clearBtn').addEventListener('click', ()=>{
        if(confirm('Clear all saved entries?')){ clearStore(); renderLists(); }
      });

      $('seedBtn').addEventListener('click', ()=>{
        const sample = [
          {id:1,name:'Ali Khan',role:'donor',blood:'O-',city:'Lahore',phone:'+92 300 0000001',notes:'Available daily'},
          {id:2,name:'Sara Ahmed',role:'donor',blood:'A+',city:'Lahore',phone:'+92 300 0000002',notes:''},
          {id:3,name:'Bilal Raza',role:'recipient',blood:'A+',city:'Lahore',phone:'+92 300 0000003',notes:'Urgent within 48h'},
          {id:4,name:'Hina Q',role:'recipient',blood:'O-',city:'Karachi',phone:'+92 300 0000004',notes:''}
        ];
        saveStore(sample); renderLists();
      });

      $('exportBtn').addEventListener('click', ()=>{
        const data = loadStore();
        const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'blood-data.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      });

      $('importBtn').addEventListener('click', ()=> $('importFile').click());
      $('importFile').addEventListener('change', async ev=>{
        const f = ev.target.files[0]; if(!f) return;
        try{
          const txt = await f.text(); const parsed = JSON.parse(txt);
          if(!Array.isArray(parsed)) throw new Error('JSON must be an array of entries');
          saveStore(parsed); renderLists(); alert('Imported '+parsed.length+' entries');
        }catch(err){ alert('Import failed: '+err.message) }
        ev.target.value='';
      });
    });

  </script>
</body>
</html>
